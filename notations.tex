
\renewcommand{\labelitemi}{$\bullet$}

\renewcommand{\qedsymbol}{$\blacksquare$}


\newcommand{\indep}{\rotatebox[origin=c]{90}{$\models$}}
\newcommand{\ot}{\otimes}
\newcommand{\eps}{\epsilon}
\newcommand{\sth}{ \ \mathrm{s.t.} \ }
\newcommand{\trans}{\mathrm{T}}
%\newcommand{\tr}[1]{\operatorname{tr}\left( #1 \right)}
\newcommand{\partr}[2]{\operatorname{tr}_{#2}\left( #1 \right)}
\newcommand{\trdist}[2]{\operatorname{D}\left( #1 | #2 \right)}
\newcommand{\lin}[1]{\mathcal{L}\left( #1 \right)} %linear operators...
\newcommand{\linH}[1]{\mathcal{L}_\mathrm{H}\left( #1 \right)}

\newcommand{\epi}{\operatorname{epi}}

%Quantum 
\newcommand{\ket}[1]{| #1 \rangle}
\newcommand{\bra}[1]{\langle #1 |}
\newcommand{\braket}[2]{\langle #1|#2\rangle}
\newcommand{\ketbra}[2]{|#1\rangle\!\langle#2|}
\newcommand{\proj}[1]{\ketbra{#1}{#1}}
\newcommand{\identity}{\openone}
\newcommand{\id}{\mathbbm{1}}
\newcommand{\cptp}{\mathcal{E}}

\newcommand{\acal}{\mathcal{A}}
\newcommand{\bcal}{\mathcal{B}}
\newcommand{\ccal}{\mathcal{C}}
\newcommand{\dcal}{\mathcal{D}}
\newcommand{\ecal}{\mathcal{E}}
\newcommand{\fcal}{\mathcal{F}}
\newcommand{\lcal}{\mathcal{L}}
\newcommand{\ocal}{\mathcal{O}}
\newcommand{\vcal}{\mathcal{V}}
\newcommand{\zcal}{\mathcal{Z}}
\newcommand{\kcal}{\mathcal{K}}
\newcommand{\hcal}{\mathcal{H}}
\newcommand{\tcal}{\mathcal{T}}
\newcommand{\scal}{\mathcal{S}}
\newcommand{\pcal}{\mathcal{P}}
\newcommand{\ucal}{\mathcal{U}}
%\newcommand{\fcal}{\mathcal{F}}

\newcommand{\sbuild}[2]{\left\{#1\,\middle|\,#2\right\}}

\newcommand{\supp}[1]{\operatorname{supp}\left({#1}\right)}

%operator spaces
\NewDocumentCommand{\bops}{ o o }
{
  \lcal\IfValueT{#1}{\!\left({#1}\IfValueT{#2}{,{#2}}\right)}
}

\NewDocumentCommand{\saops}{ o }
{
  \lcal_{s}\IfValueT{#1}{\!\left({#1}\right)}
}

\NewDocumentCommand{\posops}{ o }
{
  \lcal_{s}^{+}\IfValueT{#1}{\!\left({#1}\right)}
}

\NewDocumentCommand{\trops}{ o }
{
  \tcal\IfValueT{#1}{\!\left({#1}\right)}
}

\NewDocumentCommand{\dops}{ o }
{
  \scal\IfValueT{#1}{\!\left({#1}\right)}
}

\NewDocumentCommand{\probs}{ m m }
{
  \pcal\!\left({#1}, {#2}\right)
}

%sequence middle bit, variable, inf and sup
\NewDocumentCommand{\seq}{ m o o o }
{
  \left({#1}\right)_{ \IfValueT{#2}{#2\IfValueT{#3}{={#3}} }  }^{\IfValueT{#4}{#4}}
}

%\newcommand{\tr}[1]{\operatorname{tr}\left( #1 \right)}
%trace - optional partial trace
\NewDocumentCommand{\tr}{ m o }
{
  \operatorname{tr}{\IfValueT{#2}{_{#2}}}\left( #1 \right)
}

\newcommand{\vspan}[1]{\operatorname{span}\left(#1\right)}

\newcommand{\fmath}{\mathbb{F}}
\newcommand{\smath}{\mathbb{S}}
%\newcommand{\norm}[3]{\vert  #1 {\vert }_{#2}^{#3}} %%26/12/2013
\newcommand{\abs}[1]{{\left\lvert{#1}\right\rvert}}
\newcommand{\then}{\Rightarrow}
\newcommand\Eb{\mathbb{E}}
\newcommand\N{\mathbb{N}}
\newcommand\Z{\mathbb{Z}}
\newcommand\Q{\mathbb{Q}}
\newcommand\ps{{(\Omega, \mathcal{F}, \mathbb{P})}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\K}{\mathbb{K}}
\newcommand\Pb{\mathbb{P}}
\newcommand{\exR}{\overline{\R}}
\newcommand{\Cx}{\mathbb{C}}
\newcommand{\circleNotate}{\mathbb{T}}
\newcommand\s{$\sigma$\textrm{-field} }
\newcommand\notsubset{\subset\hspace{-3.5mm}{/}\hspace{1.5mm}}

\def\del{\dot{\Delta}}
\def\lap{\nabla}
\def\invf{\mathcal{F}^{-1}}
\def\dj{\delta_j}
\def\apo{(I + \delta B)^{-1}}
\def\A{\mathrm{A}}
\def\mcal{\mathcal{M}}
\def\divv{\mathrm{div}}
\def\rE{\mathrm{E}}
\def\e{\mathbb{E}}


%----------------------------------------------------------------------------------------------------------------------------------------------------------
%----------------------------------------------------------------------------------------------------------------------------------------------------------
%from low dimensional preparation ur paper

\newcommand{\born}{\bm{r}_0}

\newcommand{\boap}{\bm{\overline{a}}}
\newcommand{\vproj}[2]{\pi_{{#1}{#2}}}
\newcommand{\boa}{\bm{a}}
\newcommand{\bob}{\bm{b}}
\newcommand{\boc}{\bm{c}}
\newcommand{\bod}{\bm{d}}
\newcommand{\boe}{\bm{e}}
\newcommand{\bof}{\bm{f}}
\newcommand{\bog}{\bm{g}}
\newcommand{\boh}{\bm{h}}
%\newcommand{\boi}{\bm{i}} %overlap with Bable command 
\newcommand{\boj}{\bm{j}}
\newcommand{\bok}{\bm{k}}
\newcommand{\bol}{\bm{l}}
\newcommand{\bom}{\bm{m}}
\newcommand{\bon}{\bm{n}}
\newcommand{\boo}{\bm{o}}
\newcommand{\bop}{\bm{p}}
\newcommand{\boq}{\bm{q}}
\newcommand{\bor}{\bm{r}}
\newcommand{\bos}{\bm{s}}
%\newcommand{\bot}{\bm{t}} %overlap with the \perp symbol
\newcommand{\bou}{\bm{u}}
\newcommand{\bov}{\bm{v}}
\newcommand{\bow}{\bm{w}}
\newcommand{\boex}{\bm{x}}
\newcommand{\boy}{\bm{y}}
\newcommand{\boz}{\bm{z}}

\newcommand{\bogam}{\bm{\gamma}}
\newcommand{\boalpha}{\bm{\alpha}}


\newcommand{\bosig}{{\boldsymbol\sigma}}


\newcommand{\opa}{\operatorname{A}}
\newcommand{\opb}{\operatorname{B}}
\newcommand{\opc}{\operatorname{C}}
\newcommand{\opd}{\operatorname{D}}
\newcommand{\ope}{\operatorname{E}}
\newcommand{\opf}{\operatorname{F}}
\newcommand{\opg}{\operatorname{G}}
\newcommand{\oph}{\operatorname{H}}
\newcommand{\opi}{\operatorname{I}}
\newcommand{\opj}{\operatorname{J}}
\newcommand{\opk}{\operatorname{K}}
\newcommand{\opl}{\operatorname{L}}
\newcommand{\opm}{\operatorname{M}}
\newcommand{\opn}{\operatorname{N}}
\newcommand{\opo}{\operatorname{O}}
\newcommand{\opp}{\operatorname{P}}
\newcommand{\opq}{\operatorname{Q}}
\newcommand{\opr}{\operatorname{R}}
\newcommand{\ops}{\operatorname{S}}
\newcommand{\opt}{\operatorname{T}}
\newcommand{\opu}{\operatorname{U}}
\newcommand{\opv}{\operatorname{V}}
\newcommand{\opw}{\operatorname{W}}
\newcommand{\opx}{\operatorname{X}}
\newcommand{\opy}{\operatorname{Y}}
\newcommand{\opz}{\operatorname{Z}}

\newcommand{\oppi}{\operatorname{\pi}}
% \newcommand{\opf}{\mathrm{F}}
% \newcommand{\opj}{\mathrm{J}}
% \newcommand{\opx}{\mathrm{X}}
% \newcommand{\opy}{\mathrm{Y}}

\newcommand{\defeq}{:=}

\newcommand{\expr}[1]{\left\langle {#1}\right\rangle_\rho} % for the expectation value
\newcommand{\expnr}[1]{\left\langle {#1}\right\rangle} % for the expectation value without state argument



\DeclareDocumentCommand{\sdev}{ O{} m }{
  {\Delta_{{#1}} {#2}}
}
\DeclareDocumentCommand{\var}{ O{} m }{
  {\Delta^2_{#1} {#2}}
}


\DeclareDocumentCommand{\qbit}{ O{} O{+} O{\frac{1}{2}} m }{
  {{#3}\left({#1}\opi\, {#2}\, {#4}\cdot\bosig\right)}
}


\newcommand{\varr}[1]{{\var[\rho]{{#1}}}}
\newcommand{\sdevr}[1]{{\sdev[\rho]{{#1}}}}

\newcommand{\sdevmin}[1]{{\sdev{#1}_\text{min}}}
\newcommand{\varmin}[1]{{\var{#1}_\text{min}}}

\newcommand{\sdevmax}[1]{{\sdev{#1}_\text{max}}}
\newcommand{\varmax}[1]{{\var{#1}_\text{max}}}

\newcommand{\ft}[1]{\widetilde{#1}} % formal Fourier transform
\newcommand{\Cos}[1]{\cos\left(#1\right)} % cos with brackets
\newcommand{\Sin}[1]{\sin\left(#1\right)} % sin with brackets

\newcommand{\erf}{\operatorname{erf}}

\newcommand{\bracks}[1]{\left(#1\right)} % for brackets
\newcommand{\sbracks}[1]{\left[#1\right]} % square brackets
\newcommand{\com}[2]{\left[#1,#2\right]} % commutator
\newcommand{\comm}[2]{#1 #2 - #2 #1} % commutator spelled out
\newcommand{\acom}[2]{#1 #2 + #2 #1} % anti-commutator

\newcommand{\si}{\mathcal{S}}
\newcommand{\hi}{\mathcal{H}}

%\renewcommand{\max}{{\operatorname{max}}} % why do we need these??????
%\renewcommand{\min}{{\operatorname{min}}}

\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
\newcommand{\ival}{I}
\newcommand{\PUR}[3]{\operatorname{PUR}_{#1}\left({#2},{#3}\right)}


\pgfkeys{
  /drawSemiCircle/.is family, /drawSemiCircle,
  defaults/.style = {scale = \textwidth,
    aAngle = 0,
    bAngle = 0,
    rAngle = 0,
    rLength = 1,
    drawBPrime = false,
    drawRightAngles = true,
    rightAngleScale = 0.07},
  scale/.estore in = \scale,
  aAngle/.estore in = \aAngle,
  bAngle/.estore in =\bAngle,
  rAngle/.estore in =\rAngle,
  rLength/.estore in =\rLength,
  drawBPrime/.estore in =\drawBPrime,
  rSub/.estore in =\rSub,
  drawRightAngles/.estore in =\drawRightAngles,
  rightAngleScale/.estore in =\rightAngleScale,
}



\newcommand{\DrawSemiCircle[2]}{%
  \pgfkeys{/drawSemiCircle, defaults, #1}%
  \begin{tikzpicture}[scale=\scale/2cm,>=stealth] %because a circle of radius 1 is 2cm wide this is the base length for the figure
    % draw the base line (before clipping so it doesn't get cut in half)
    \draw (-1,0) -- (1,0);

    % clip out the upper half
    \clip (-1cm, 0cm) rectangle (1.2cm, 1.2cm);

    % Draw the circle
    \draw (0cm,0cm) circle (1cm);

    % Put the a and b vectors on it
    \draw [name=vect,thick,->] (0,0) -- node[pos=1,fill=none,label=\aAngle:$\boa$] {} (\aAngle:1cm);
    \draw [name=vect,thick,->] (0,0) -- node[pos=1,fill=none,label=\bAngle:$\bob$] {} (\bAngle:1cm);
    \IfEqCase{\drawBPrime}{
      {true}{
        \pgfmathsetmacro{\bPrimeAngle}{\bAngle-90};
        \draw [name=vect,thick,->] (0,0) -- node[pos=1, left  = 0.1 ,fill=none] {$\bob^\prime$} (\bPrimeAngle:1cm);
        \IfEqCase{\drawRightAngles}{
          {true}{
            \pgfmathsetmacro{\midAngle}{(\bPrimeAngle+\bAngle)/2}
            \pgfmathsetmacro{\midLength}{sqrt(2)*\rightAngleScale}
            \draw [name=rangle] (\bAngle:\rightAngleScale) -- (\midAngle:\midLength) -- (\bPrimeAngle:\rightAngleScale);
          }
          {false}{}
        }
      }
      {false}{}
    }
    % now the r vector
    \draw [name=vect,thick,->] (0,0) -- node[midway, fill=white] {$\bor_{\rSub}$} (\rAngle:\rLength);

    % now we can compute r.a, r.b
    \pgfmathsetmacro{\ra}{1*\rLength*cos(\aAngle-\rAngle)}
    \pgfmathsetmacro{\rb}{1*\rLength*cos(\bAngle-\rAngle)}

    % and draw a*, b*, x and y
    \draw [name=vect,thick,->] (0,0) -\- node[pos=1, below right = 0.06 and 0.03 ,fill=none] {$\boa^*$} (\aAngle:\ra);
    \draw [name=vect,thick,->] (\aAngle:\ra) -- node[midway,fill=white] {$\bm{x}$} (\rAngle:\rLength);
    \IfEq{\rb}{0}{
      \IfEqCase{\drawRightAngles}{
        {true}{
          \pgfmathsetmacro{\midAngle}{(\rAngle+\bAngle)/2}
          \pgfmathsetmacro{\midLength}{sqrt(2)*\rightAngleScale}
          \draw [name=rangle] (\rAngle:\rightAngleScale) -- (\midAngle:\midLength) -- (\bAngle:\rightAngleScale);
        }
        {false}{}
      }
    }
    {\draw [name=vect,thick,->] (0,0) -- node[pos=1, below left  = 0.05 and 0.03 ,fill=none] {$\bob^*$} (\bAngle:\rb);
      \draw [name=vect,thick,->] (\bAngle:\rb) -- node[midway,fill=white] {$\bm{y}$} (\rAngle:\rLength);}

    % draw right angles between a*,x and b*,y
    \IfEq{\ra}{0}{}{
      \IfEqCase{\drawRightAngles}{
        {true}{
          \pgfmathsetmacro{\rx}{\rLength*cos(\rAngle)}
          \pgfmathsetmacro{\ry}{\rLength*sin(\rAngle)}

          \pgfmathsetmacro{\rax}{\ra*cos(\aAngle)}
          \pgfmathsetmacro{\ray}{\ra*sin(\aAngle)}
          \pgfmathsetmacro{\xxUnNormed}{\rx - \rax}
          \pgfmathsetmacro{\xyUnNormed}{\ry - \ray}
          \pgfmathsetmacro{\xx}{\xxUnNormed / sqrt(\xxUnNormed*\xxUnNormed + \xyUnNormed*\xyUnNormed)}
          \pgfmathsetmacro{\xy}{\xyUnNormed / sqrt(\xxUnNormed*\xxUnNormed + \xyUnNormed*\xyUnNormed)}
          \pgfmathsetmacro{\aStartX}{\rax * (1 + \rightAngleScale/\ra)}
          \pgfmathsetmacro{\aStartY}{\ray * (1 + \rightAngleScale/\ra)}
          \pgfmathsetmacro{\aMidX}{\aStartX  + \rightAngleScale*\xx}
          \pgfmathsetmacro{\aMidY}{\aStartY  + \rightAngleScale*\xy}
          \pgfmathsetmacro{\aEndX}{\rax + \rightAngleScale*\xx}
          \pgfmathsetmacro{\aEndY}{\ray + \rightAngleScale*\xy}
          \draw [name=rangle] (\aStartX,\aStartY) --  (\aMidX,\aMidY) -- (\aEndX,\aEndY);
        }
        {false}{}
      }
    }
    \IfEq{\rb}{0}{}{
      \IfEqCase{\drawRightAngles}{
        {true}{
          \pgfmathsetmacro{\rbx}{\rb*cos(\bAngle)}
          \pgfmathsetmacro{\rby}{\rb*sin(\bAngle)}
          \pgfmathsetmacro{\yxUnNormed}{\rx - \rbx}
          \pgfmathsetmacro{\yyUnNormed}{\ry - \rby}
          \pgfmathsetmacro{\yx}{\yxUnNormed / sqrt(\yxUnNormed*\yxUnNormed + \yyUnNormed*\yyUnNormed)}
          \pgfmathsetmacro{\yy}{\yyUnNormed / sqrt(\yxUnNormed*\yxUnNormed + \yyUnNormed*\yyUnNormed)}
          \pgfmathsetmacro{\bStartX}{\rbx * (1 + \rightAngleScale/\rb)}
          \pgfmathsetmacro{\bStartY}{\rby * (1 + \rightAngleScale/\rb)}
          \pgfmathsetmacro{\bMidX}{\bStartX  + \rightAngleScale*\yx}
          \pgfmathsetmacro{\bMidY}{\bStartY  + \rightAngleScale*\yy}
          \pgfmathsetmacro{\bEndX}{\rbx + \rightAngleScale*\yx}
          \pgfmathsetmacro{\bEndY}{\rby + \rightAngleScale*\yy}
          \draw [name=rangle] (\bStartX,\bStartY) --  (\bMidX,\bMidY) -- (\bEndX,\bEndY);
        }
        {false}{}
      }
    }
  \end{tikzpicture}
}
%correctly handles the cases where all the vectors are different, where b = r_0 and/or where b' = r_1 but no others (e.g. b' = r_1, b = a etc. will break the labels)
\DeclareDocumentCommand{\DrawSphere}{ m m m }{%
  \begin{tikzpicture}
    \tdplotsetmaincoords{10}{0}
    \tdplotsetrotatedcoords{90}{90}{-90}
    \coordinate (O) at (0,0,0);
    \pgfmathsetmacro{\scale}{0.1cm}

    \pgfmathsetmacro{\aAngle}{{#1}}
    \pgfmathsetmacro{\bAngle}{{#2}}
    \pgfmathsetmacro{\rZeroAngle}{{#3}}
    \pgfmathsetmacro{\rOneAngle}{\aAngle - abs(\aAngle - \rZeroAngle)}
    \pgfmathsetmacro{\rOneLength}{\rOneAngle < 0 ? sqrt( 1 + (cos(\aAngle - \bAngle) / cos(\bAngle - \aAngle + 90))^2  ) *  abs(cos(\rZeroAngle - \aAngle)) : 1}
    \pgfmathsetmacro{\rOneAngle}{\rOneAngle < 0 ? 0 : \rOneAngle}

    \pgfmathsetmacro{\bPrimeAngle}{\bAngle - 90}

    \tdplotsetcoord{a}{\scale}{90}{\aAngle}
    \tdplotsetcoord{b}{\scale}{90}{\bAngle}
    \tdplotsetcoord{bPrime}{\scale}{90}{\bPrimeAngle}
    \tdplotsetcoord{rZero}{\scale}{90}{\rZeroAngle}
    \tdplotsetcoord{rOne}{\rOneLength*\scale}{90}{\rOneAngle}

    \tdplotdrawarc[tdplot_screen_coords]{(O)}{\scale}{0}{360}{}{}

    %\draw [thick,->] (O) -- node[pos=1, right = 0.1, fill=none] {$\boa$} (a);
    \draw [thick,->] (O) -- node[pos=1,fill=none, label={\aAngle:$\boa$}] {} (a);
    \IfEq{\bAngle}{\rZeroAngle}{
      \draw [thick,->] (O) -- node[pos=1, fill=none, label={\bAngle:$\bob = \bor_0$}] {} (b);
    }{
      \draw [thick,->] (O) -- node[pos=1, fill=none, label={\bAngle:$\bob$}] {} (b);
      \draw [thick,->] (O) -- node[pos=1, fill=none, label={\rZeroAngle:$\bor_0$}] {} (rZero);
    }

    \IfEq{\bPrimeAngle}{\rOneAngle}{
      \IfEq{\rOneLength}{1}{
        \draw [thick,->] (O) -- node[pos=1, fill=none, label={\bPrimeAngle:$\bob^\prime = \bor_1$}] {} (bPrime);
      }{
        \draw [thick,->] (O) -- node[pos=1, fill=none, label={\bPrimeAngle:$\bob^\prime=\hat\bor_1$}] {} (bPrime);
        \draw [thick,->] (O) -- node[pos=1, fill=none, label={[label distance=0.2*\scale]120:$\bor_1$}] {} (rOne);
      }
    }{
      \draw [thick,->] (O) -- node[pos=1, fill=none, label={\bPrimeAngle:$\bob^\prime$}] {} (bPrime);
      \draw [thick,->] (O) -- node[pos=1, fill=none, label={\rOneAngle:$\bor_1$}] {} (rOne);
    }
    \pgfmathsetmacro{\bRZeroCircleRad}{abs(sin(\bAngle - \rZeroAngle))}
    \pgfmathsetmacro{\bRZeroCircleLoc}{abs(cos(\bAngle - \rZeroAngle))}
    \tdplotdrawarc[tdplot_rotated_coords]{(0,0,\bRZeroCircleLoc*\scale)}{\bRZeroCircleRad*\scale}{0}{180}{anchor=north}{  }
    \tdplotdrawarc[tdplot_rotated_coords, style=dashed]{(0,0,\bRZeroCircleLoc*\scale)}{\bRZeroCircleRad*\scale}{180}{360}{anchor=north}{  }

    \pgfmathsetmacro{\bROneCircleRad}{abs(sin(\bAngle - \rOneAngle))}
    \pgfmathsetmacro{\bROneCircleLoc}{cos(\bAngle - \rOneAngle)}
    \tdplotdrawarc[tdplot_rotated_coords]{(0,0,\bROneCircleLoc*\scale)}{\bROneCircleRad*\scale}{0}{180}{anchor=north}{  }
    \tdplotdrawarc[tdplot_rotated_coords, style=dashed]{(0,0,\bROneCircleLoc*\scale)}{\bROneCircleRad*\scale}{180}{360}{anchor=north}{  }

    \tdplotsetrotatedcoords{\aAngle}{90}{-90}
    \pgfmathsetmacro{\aRCircleRad}{abs(sin(\aAngle - \rZeroAngle))}
    \pgfmathsetmacro{\aRCircleLoc}{abs(cos(\aAngle - \rZeroAngle))}
    \tdplotdrawarc[tdplot_rotated_coords]{(0,0,\aRCircleLoc*\scale)}{\aRCircleRad*\scale}{0}{180}{anchor=north}{  }
    \tdplotdrawarc[tdplot_rotated_coords, style=dashed]{(0,0,\aRCircleLoc*\scale)}{\aRCircleRad*\scale}{180}{360}{anchor=north}{  }
  \end{tikzpicture}
}


%---------------------------------------------------------------------------------------------------------------------------------------------------------
% specific for cov-mur stuff
%----------------------------------------------------------------------------------------------------------------------------------------------------------
\newcommand{\grp}[3]{g\left({#1}, {#2}, {#3}\right)}
\newcommand{\map}[3]{R_{{#1}, {#2}, {#3}}}

\newcommand{\adj}[1]{{\operatorname{adj}\left({#1}\right)}}

\DeclareDocumentCommand{\cyc}{ O{n} }{
  {\mathbb{Z}_n}
}

\newcommand{\norm}[1]{{\left\lVert{#1}\right\rVert}}

\DeclareDocumentCommand{\pnorm}{ m O{p} }{
  \norm{{#1}}_{#2}
}
\newcommand{\fdiv}[3]{D_{#1}\left({#2}\parallel{#3}\right)}

\newcommand{\ovms}{\mathcal{M}}

%---------------------------------------------------------------------------------------------------------------------------------------------------------
% specific for interferometric prep stuff
%----------------------------------------------------------------------------------------------------------------------------------------------------------

\newcommand{\MOD}[1]{#1_{\mathrm{mod}}} % APP's Pmod and Qmod
\newcommand{\psdev}[1]{\tilde\Delta{\big(#1\big)}} % for the periodic standard deviation
%\newcommand{\ws}[1]{\delta{\big(#1\big)}} % for the delta-spread
\DeclareDocumentCommand{\ws}{ m o }{
  \operatorname{W}\IfValueT{ #2 }{_{#2}}{ } \left({#1}\right)
}

\DeclareDocumentCommand{\wsDev}{ m o }{
  \Delta\IfValueT{ #2 }{_{#2}}{ } \left({#1}\right)
}

\DeclareDocumentCommand{\lPVar}{ m m O{p} }{
  \delta_{#3}\left({#1}, {#2}\right)
}

\newcommand{\dom}[1]{\mathcal{D}(#1)}
\newcommand{\E}{\mathsf{E}} % spectral measure
\newcommand{\iunit}{\mathrm{i}} % for the imaginary unit i
%\newcommand{\diff}[2]{\frac{{\rm d}#1}{{\rm d }#2}} % diffs
\newcommand{\IT}{{I}_T} % for the interval [-T/2,T/2]
\newcommand{\IK}{{I}_K} % for the interval [-K/2,K/2]
\newcommand{\Ewp}{\mathsf E}
\newcommand{\Efc}{\mathsf F}

%pictures
\newcommand{\hh}{^H} %Heisenberg picture
\renewcommand{\ss}{^S} %Schroedinger picture

\newcommand{\expe}[2]{\left\langle{#1}\right\rangle_{#2}}

\DeclareDocumentCommand{\borel}{ m o }{
  \mathcal{B}\left({#1}\IfValueT{#2}{,{#2}} \right)
}

\newcommand{\width}[2]{W_{#2}\left({#1}\right)}

\DeclareDocumentCommand{\calibError}{ m m m o }{
  \Delta^{\IfValueTF{#4}{#4}{c}}_{#3}\left({#1}, {#2}\right)
}

\newcommand{\spec}[1]{\sigma\left({#1}\right)}
\newcommand{\res}[1]{\rho\left({#1}\right)}